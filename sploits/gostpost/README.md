# Gostpost

Сервис, представляющий собой нечто вроде электронной почты с (бесполезным) шифрованием. В основе лежит сомнительная фича marshmallow-sqlalchemy для Python. 

### Задуманные (важные) уязвимости
1. `[routes/letters.py:15] letter = LetterSchema().load(data)`\
С `load_instance = True` поведение marshmallow-sqlalchemy таково, что при наличии вложенных схем, они тоже десериализуются и, при отсутствии primary key, содаются.

2. `[models/boyarin.py:7] uid: Mapped[str] = mapped_column()` \
Очевидно, бесполезное поле, да еще и не unique, а значит, потенциально `get_shared_key` выдаст тот же ключ даже для другого пользователя.

3. `[models/boyarin.py:12] son: Mapped["Boyarin | None"] = db.relationship(remote_side=[id])`\
son задается со стороны получающего доступ, а значит, необязательно модифицировать существующего пользователя.

### Суть эксплоита

Отправить сообщение вида:
```JSON
{
    "recipient": {"uid": *target_uid*, "name": "nm", "passphrase": "ps", "son_id": *target_id*},
    "content": "",
    "is_encrypted": False,
}
```
Это создаст пользователя nm:ps с uid цели и son_id установленным на цель. Фактически, этот пользователь почти точная копия цели, учитывая, что ключи получаются такие же и сообщения видно те же, из-за son_id.

Затем, нужно лишь вывести сообщения, аналогично тому, как это делает приложенный клиент.
